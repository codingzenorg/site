<script type="text/javascript">
  document.body = document.createElement("body");
  document.body.style.margin = "0px";
  document.body.style.borderColor = "blue";
  document.body.style.borderStyle = "solid";
  document.body.style.borderWidth = "5px";

  var canv = document.createElement('canvas');
  canv.width = window.innerWidth - 10; // - 2x border width
  canv.height = window.innerHeight - 10;
  document.body.appendChild(canv);

  console.log(canv);

  var board = {
    cellSize: 10,
    calcSize: function(value) {
      return Math.floor(value / board.cellSize);
    }
  };

  var snake = {
    x: 10,
    y: 10,
    trail: [],
    tailSize: 5
  };

  var apple = {
    x: 15,
    y: 15
  };

  var xv = yv = 0; //velocity variation


  window.onload = function() {

    board.width = board.calcSize(canv.width);// TODO: oop
    board.height = board.calcSize(canv.height);

    ctx = canv.getContext("2d");
    document.addEventListener("keydown", keyPush);
    setInterval(game, 1000 / 15); //game rhythm 1s/15
  }


  function game() {
    snake.x += xv;
    snake.y += yv;
    if (snake.x < 0) { //player position < 0 -> put player on the other side
      snake.x = board.width - 1;
    }
    if (snake.x > board.width - 1) { //player position > scene size -> put player on the other side
      snake.x = 0;
    }
    if (snake.y < 0) {
      snake.y = board.height - 1;
    }
    if (snake.y > board.height - 1) {
      snake.y = 0;
    }

    //drawing the scene
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canv.width, canv.height);

    //drawing the player
    ctx.fillStyle = "lime";
    for (var i = 0; i < snake.trail.length; i++) {
      ctx.fillRect(snake.trail[i].x * board.cellSize, snake.trail[i].y * board.cellSize, board.cellSize - 2, board.cellSize - 2);
      if (snake.trail[i].x == snake.x && snake.trail[i].y == snake.y) { //self colision
        snake.tail = 5;
      }
    }

    //add current player position for trail (Xoooooo)
    snake.trail.push({
      x: snake.x,
      y: snake.y
    });
    //adjust tail size... trail must be the same site of tail
    while (snake.trail.length > snake.tail) {
      snake.trail.shift();
    }

    if (apple.x == snake.x && apple.y == snake.y) { //if player colide with the apple
      snake.tail++; //increase tail
      apple.x = Math.floor(Math.random() * board.width); //new position for apple
      apple.y = Math.floor(Math.random() * board.height); //new position for apple
    }
    //paint apple
    ctx.fillStyle = "red";
    ctx.fillRect(apple.x * board.cellSize, apple.y * board.cellSize, board.cellSize - 2, board.cellSize - 2);
  }

  function keyPush(evt) {
    console.log(evt);
    switch (evt.keyCode) {
      case 37: //ArrowLeft
        xv = -1;
        yv = 0;
        break;
      case 38: //ArrowUp
        xv = 0;
        yv = -1;
        break;
      case 39: //ArrowRight
        xv = 1;
        yv = 0;
        break;
      case 40: //ArrowDown
        xv = 0;
        yv = 1;
        break;
      default:
        return;
    }
    evt.preventDefault();
  }
</script>
